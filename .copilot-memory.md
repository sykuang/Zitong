# Zitong Project Status — Last Updated: 2026-02-17

## Project Overview
**Zitong** — A BoltAI-like cross-platform AI chat client built with **Tauri 2 + React 19**.
- **Location**: `/Users/kenkuang/src/Zitong/`
- **App identifier**: `com.primattek.zitong`
- **Package manager**: pnpm
- **DB**: SQLite at `~/Library/Application Support/com.primattek.zitong/zitong.db`

## Tech Stack
- **Backend**: Tauri 2.x, Rust, rusqlite 0.31 (bundled), reqwest 0.12, reqwest-eventsource 0.6
- **Frontend**: React 19, TypeScript, Vite 7.3.1, Tailwind CSS 4.1.18
- **Tauri plugins**: global-shortcut, dialog, opener, clipboard-manager, tray-icon
- **Frontend packages**: @tauri-apps/plugin-opener, @tauri-apps/plugin-clipboard-manager

## Key Files
| File | Lines | Purpose |
|------|-------|---------|
| `src-tauri/src/providers.rs` | ~1290 | AI provider streaming, model listing, Copilot OAuth |
| `src-tauri/src/commands.rs` | ~450 | Tauri IPC commands (conversations, messages, providers, settings, templates, folders, ai_commands, assistants) |
| `src-tauri/src/lib.rs` | ~78 | Plugin registration, DB init, all command handlers registered |
| `src-tauri/src/db.rs` | ~870 | SQLite schema (10 tables) + CRUD for all entities |
| `src/components/ChatMessage.tsx` | ~120 | Renders messages with markdown, code blocks, Copier with Tauri clipboard |
| `src/components/ChatInput.tsx` | ~245 | Dynamic model fetching, smart default provider |
| `src/components/ChatArea.tsx` | ~250 | Chat view with assistant selector in header, quick actions |
| `src/components/SettingsPanel.tsx` | ~1800 | 7 tabs: providers, general, appearance, shortcuts, templates, commands, assistants |
| `src/components/Sidebar.tsx` | ~230 | Conversation list with search, inline rename, archive |
| `src/context/AppContext.tsx` | ~336 | App state, assistants management, settings |
| `src/types/index.ts` | ~195 | TypeScript types (Provider, Conversation, Message, AppSettings, AiCommand, Assistant, etc.) |
| `src/commands/index.ts` | ~195 | Tauri IPC wrappers for all backend commands |

## AI Providers Supported (10)
openai, anthropic, gemini, ollama, github_copilot, mistral, groq, deepseek, openrouter, xai

## GitHub Copilot Integration
- **Auth**: Device OAuth flow (Client ID: `Iv1.b507a08c87ecfe98`)
- **API base**: `https://api.enterprise.githubcopilot.com` (enterprise Copilot)
- **Token exchange**: GitHub token → Copilot token before each API call
- **Model listing**: Fetches from `/models`, filters out embed models
- **Headers**: `Copilot-Integration-Id: vscode-chat`
- **Status**: Working — 36 models returned from API

## Completed Features
- [x] Project scaffold (Tauri 2 + React)
- [x] SQLite data layer (providers, conversations, messages, settings, prompt_templates, folders, ai_commands, assistants)
- [x] AI provider streaming (10 providers, SSE-based)
- [x] Dynamic model fetching (zero hardcoded models)
- [x] GitHub Copilot Device OAuth (backend + frontend)
- [x] Clipboard copy of user code (@tauri-apps/plugin-clipboard-manager)
- [x] Auto-save Copilot token to DB after OAuth
- [x] Smart default provider selection (auto-pick first configured provider)
- [x] Provider list merge (DB providers merged with defaults for UI)
- [x] HotkeyRecorder component (click-to-record keyboard shortcut capture)
- [x] **Stream 1**: Code block copy fix — Tauri clipboard + "Copied!" feedback
- [x] **Stream 2**: Prompt Templates UI — full CRUD with variable detection ({{variable}})
- [x] **Stream 3**: Wire backend to UI — search bar, inline rename, archive, quick actions
- [x] **Stream 4**: Provider UX polish — BoltAI-style sidebar layout, DEFAULT badge, model refresh
- [x] **Stream 5**: Appearance tab — theme, accent color, font, chat bubble style, code theme, compact mode
- [x] **Stream 6**: Shortcuts tab — global hotkey with HotkeyRecorder, app shortcuts reference table
- [x] **Stream 7**: AI Commands — 12 seed commands, full CRUD, behavior/provider/model/language/shortcut config
- [x] **Stream 8**: Assistants — 5 seed personas, full CRUD, temperature/maxTokens, default toggle, header selector

## DB Schema (10 tables)
conversations, messages, attachments, providers, prompt_templates, folders, settings, ai_commands, assistants

## Settings Panel Tabs (7)
1. **Providers**: Sidebar list + detail panel, DEFAULT badge, model count/refresh, Copilot OAuth
2. **General**: Default system prompt, font size, send-on-enter, stream responses
3. **Appearance**: Theme (3), accent color (7), font family, chat bubble style, code theme, compact mode
4. **Shortcuts**: Global hotkey recorder, app shortcuts reference (6 shortcuts)
5. **Templates**: Full CRUD with category, variable detection, left-right layout
6. **Commands**: Full CRUD, 12 seed commands, behavior/provider/model/language/shortcut per command
7. **Assistants**: Full CRUD, 5 seed personas, icon picker, system prompt, provider/model, temperature/maxTokens, default toggle
- [x] HotkeyRecorder component (click-to-record keyboard shortcut capture)

## HotkeyRecorder Component Details
- Captures keyboard shortcuts requiring at least one modifier key
- Converts KeyboardEvent to Tauri accelerator format (e.g., "CommandOrControl+Shift+Space")
- Platform-specific display: Mac (⌘, ⇧, ⌥) vs Windows (Ctrl, Alt, Shift)
- Animated "Press your shortcut..." prompt while recording
- Cancel button to abort recording

## Known Debug Artifacts (to clean up)
- `eprintln!` statements in `commands.rs` and `providers.rs`
- `/tmp/zitong_debug.txt` file writes in `commands.rs`
- `console.log` / `console.error` debug lines in `ChatInput.tsx`

## Remaining Work
- [ ] Wire HotkeyRecorder to actual Tauri global-shortcut plugin registration
- [ ] System tray icon
- [ ] File attachments
- [ ] Proper error handling / user notifications
- [ ] Clean up debug logging (eprintln!, console.log, /tmp writes)
- [ ] Multi-conversation support UI polish
- [ ] Export/import conversations
- [ ] Wire AI Commands to actual text selection / command palette
- [ ] Wire Assistants to conversation creation (auto-set system prompt from active assistant)

## Key Bug Fixes Applied
1. **setInterval async overlap** → recursive setTimeout for Copilot auth polling
2. **Clipboard not working** → navigator.clipboard.writeText fails in Tauri → switched to plugin
3. **Models not loading** → default provider "openai" not in DB → auto-select first configured
4. **defaultSettings hardcoded** → changed from "openai"/"gpt-4o" to empty strings
5. **Provider list disappearing** → replaced ternary with Map-based merge strategy
6. **Copilot token not persisted** → auto-save called onSave (closed modal) → call saveProvider directly

## DB Schema Notes
- Provider struct uses `#[serde(rename_all = "camelCase")]` and `#[serde(rename = "type")]` for provider_type
- Currently one provider in DB: `github_copilot` with 40-char token
- Settings stored as key-value pairs
